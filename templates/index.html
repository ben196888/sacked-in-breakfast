{% extends "base.html" %}

{% block head %}
    <!-- tinymap -->
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> 
    <script src="/static/vendor/jquery.tinyMap.min.js"></script>
    <!-- tinymap -->
    <script>
    var event_timer;

    function get_location(e)
    {
        if (navigator.geolocation)
        {
            navigator.geolocation.getCurrentPosition(function showPosition(position)
            {
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;
                var loc = {x: lat, y: lng};
                //$('#demo').append(loc);
                $('#map').tinyMap('clear', ['marker']);
                $('#map').tinyMap('panto', loc);
                $('#map').tinyMap('modify', {
                    zoom: 17,
                    marker: [{addr: [lat, lng], text:'現在位置'}]
                });
            });
        }
        else
        {
            var text="Geolocation is not supported by this browser.";
            //$('#demo').append(text);
        }
    }

    $(function(){
            $("body").on("click", ".get_location", function(e){
                if (event_timer){
                    clearTimeout(event_timer);
                }
                event_timer = setTimeout(function(){get_location(e);}, 100);
            });
    })

    $(function () {
        $('#map').tinyMap({
            center: '臺灣',
            zoom: 7
        });
    });
    </script>
    <!--<script>
        $('#shop_list').listview('refresh');
        function address_search(e){
            $("#address_list").html("");
            var search_text = $(e.target).val();
            $.post("./add_card", $(e.target).val()).done(function(data){
                var monsters = [];
                $.each(data, function(key, monster){
                    monsters.push('<li><a href="' + window.location.pathname + '?target=' + key + '"><div class="card-' + key + '" stlye="float: left;"></div>' + key + ' - ' + monster.n + '</a></li>');
                });
                $("#monster_list").append(monsters);
                $('#monster_list').listview('refresh');
            });
        }
    </script>-->
</script>
{% endblock %}

{% block content %}
<div data-role="header">
    <h1>早餐店</h1>
    <a href="/add" data-icon="plus" class="ui-btn-right">新增</a>
</div>

<div data-role="content">
    <input id="shop_search" type="search" name="search" value="" />
    <a href="#" class="get_location" data-role="button" data-inline="true">Get location</a>
    <div id="demo"></div>
    <div id="map"></div>
    <ul id="shop_list" data-role="listview" data-inset="true">
        {% for s in shops %}
        <li><a href="/{{s.sid}}">{{s.sid}} - {{s.name}}</a></li>
        {% endfor %}
    </ul>
    <!--
    <a href="#" data-role="button" data-icon="search" data-iconpos="notext" data-theme="c" data-inline="true">add</a>
    
    <div data-role="controlgroup" data-type="horizontal">
        <input id="address_search" data-wrapper-class="controlgroup-textinput ui-btn" type="search" name="search" value="" />
        <a href="#" data-role="button" data-icon="add"></a>
    </div>

    -->
</div>
{% endblock %}